# 파일 전송
multipass transfer deployment.yaml k3s-vm:/home/ubuntu/deployment.yaml
multipass transfer demo-0.0.1-SNAPSHOT.jar k3s-vm:/home/ubuntu/demo-0.0.1-SNAPSHOT.jar
multipass transfer Dockerfile k3s-vm:/home/ubuntu/Dockerfile
multipass transfer service.yaml k3s-vm:/home/ubuntu/service.yaml


# 환경 셋팅
sudo apt update
sudo apt install -y docker.io
curl -sfL https://get.k3s.io | sh -s - --write-kubeconfig-mode 644
sudo usermod -aG docker $USER

# 레지스트르 컨테이너 등록
docker run -d -p 5000:5000 --name registry registry:2


# 나갔다가, 재접속
exit
multipass shell k3s-vm


# 빌드 & 레지스터 등록
docker build -t localhost:5000/my-spring-app:latest .
docker push localhost:5000/my-spring-app:latest

# 파드 생성
k3s kubectl delete deployment my-spring-app
k3s kubectl apply -f deployment.yaml
k3s kubectl get pods

# 오토스케일링
k3s kubectl autoscale deployment my-spring-app --cpu-percent=50 --min=1 --max=5

# 서비스 등록
k3s kubectl apply -f service.yaml
k3s kubectl get services


# 가상머신 삭제 및 재 생성
multipass delete k3s-vm
multipass purge
multipass launch --name k3s-vm --memory 1G --disk 10G


# 로그 보기
k3s kubectl logs <파드 이름>